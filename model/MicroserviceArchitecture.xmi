<?xml version="1.0" encoding="UTF-8"?>
<micro:MicroserviceArchitecture
    xmi:version="2.0"
    xmlns:xmi="http://www.omg.org/XMI"
    xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
    xmlns:micro="http://it.univa.disim.micro"
    xsi:schemaLocation="http://it.univa.disim.micro microArch.ecore"
    name="MDEForge">
  <services
      xsi:type="micro:AggregateService"
      name="user-service"
      fullname="UserService"
      description="User Service - MDEForge platform. "
      shortname="User"
      port="5000"
      models="//@models.1 //@models.4">
    <modelEvents
        name="userModelEvent"
        model="//@models.1"/>
    <operation
        name="createUser"
        publish="//@services.0/@api/@events.0"
        model="//@models.1"
        isMethodController="true"/>
    <operation
        name="updateUser"
        operationType="update"
        publish="//@services.0/@api/@events.1"
        model="//@models.1"
        isMethodController="true"/>
    <operation
        name="findUser"
        operationType="retrieve"
        model="//@models.1"
        isMethodController="true"/>
    <operation
        name="deleteUser"
        operationType="delete"
        publish="//@services.0/@api/@events.2"
        model="//@models.1"/>
    <api name="api">
      <events
          name="UserCreatedEvent"/>
      <events
          name="UserUpdatedEvent"/>
      <events
          name="UserDeletedEvent"/>
      <commands
          name="ValidateUserCommand"
          commandType="invoke"/>
      <commands
          name="ValidateUserListCommand"
          commandType="invoke"/>
      <infos
          name="User"
          dto="//@models.1"/>
      <infos
          name="Role"
          dto="//@models.4"/>
    </api>
  </services>
  <services
      xsi:type="micro:AggregateService"
      name="workspace-service"
      fullname="WorkspaceService"
      description="Workspace Service - MDEForge platform. "
      shortname="Workspace"
      port="5001"
      handleModelEvents="//@services.2/@modelEvents.0"
      models="//@models.0">
    <modelEvents
        name="workspaceModelEvent"
        model="//@models.0"/>
    <operation
        name="createWorkspace"
        publish="//@services.1/@api/@events.0"
        model="//@models.0"
        isMethodController="true">
      <Saga
          name="CreateWorkspace">
        <Steps
            name="rejectCreateWorkspaceCMD"
            commands="//@services.1/@api/@commands.0"/>
        <Steps
            name="validateUserCMD"
            commands="//@services.0/@api/@commands.0"/>
        <Steps
            name="addProjectsToWorkspaceCMD"
            commands="//@services.2/@api/@commands.0 //@services.2/@api/@commands.1"/>
        <Steps
            name="completeCreateWorkspaceCMD"
            commands="//@services.1/@api/@commands.1"/>
        <Data
            name="CreateWorkspace"/>
      </Saga>
    </operation>
    <operation
        name="updateWorkspace"
        operationType="update"
        model="//@models.0"
        isMethodController="true">
      <Saga
          name="UpdateWorkspace">
        <Steps
            name="validateUserCMD"
            commands="//@services.0/@api/@commands.0"/>
        <Steps
            name="editProjectsToWorkspaceCMD"
            commands="//@services.2/@api/@commands.2 //@services.2/@api/@commands.3"/>
        <Steps
            name="updateWorkspaceCMD"
            commands="//@services.1/@api/@commands.2"/>
        <Data
            name="UpdateWorkspace"/>
      </Saga>
    </operation>
    <operation
        name="completeUpdateWorkspace"
        operationType="update"
        publish="//@services.1/@api/@events.1"
        model="//@models.0"/>
    <operation
        name="findWorkspace"
        operationType="retrieve"
        model="//@models.0"
        isMethodController="true"/>
    <operation
        name="deleteWorkspace"
        operationType="delete"
        publish="//@services.1/@api/@events.2"
        model="//@models.0"
        isMethodController="true"/>
    <operation
        name="addProjectToWorkspace"
        operationType="update"
        model="//@models.0"
        isMethodController="true">
      <Saga
          name="AddProjectToWorkspace">
        <Steps
            name="validateUserCMD"
            commands="//@services.0/@api/@commands.0"/>
        <Steps
            name="validateProjectCMD"
            commands="//@services.2/@api/@commands.4"/>
        <Steps
            name="addProjectToWorkspaceCMD"
            commands="//@services.1/@api/@commands.3"/>
        <Data
            name="AddProjectToWorkspace"/>
      </Saga>
    </operation>
    <operation
        name="completeAddProjectToWorkspace"
        operationType="update"
        publish="//@services.1/@api/@events.3"
        model="//@models.0"/>
    <operation
        name="removeProjectInWorkspace"
        operationType="update"
        publish="//@services.1/@api/@events.4"
        model="//@models.0"
        isMethodController="true"/>
    <api name="api">
      <events
          name="WorkspaceCreatedEvent"/>
      <events
          name="WorkspaceUpdatedEvent"/>
      <events
          name="WorkspaceDeletedEvent"/>
      <events
          name="AddedProjectToWorkspaceEvent"/>
      <events
          name="RemovedProjectInWorkspace"/>
      <commands
          name="RejectCreateWorkspaceCommand"/>
      <commands
          name="CompleteCreateWorkspaceCommand"
          commandType="invoke"/>
      <commands
          name="UpdateWorkspaceCommand"
          commandType="invoke"/>
      <commands
          name="AddProjectToWorkspaceCommand"
          commandType="invoke"/>
      <infos
          name="Workspace"
          dto="//@models.0"/>
    </api>
  </services>
  <services
      xsi:type="micro:AggregateService"
      name="project-service"
      fullname="ProjectService"
      description="Project Service - MDEForge platform. "
      shortname="Project"
      port="5002"
      handleModelEvents="//@services.1/@modelEvents.0 //@services.3/@modelEvents.0 //@services.0/@modelEvents.0"
      models="//@models.2">
    <modelEvents
        name="projectModelEvent"
        model="//@models.2"/>
    <operation
        name="createProject"
        publish="//@services.2/@api/@events.0"
        model="//@models.2"
        isMethodController="true"/>
    <operation
        name="updateProject"
        operationType="update"
        publish="//@services.2/@api/@events.1"
        model="//@models.2"
        isMethodController="true"/>
    <operation
        name="findProject"
        operationType="retrieve"
        model="//@models.2"
        isMethodController="true"/>
    <operation
        name="deleteProject"
        operationType="delete"
        publish="//@services.2/@api/@events.2"
        model="//@models.2"
        isMethodController="true"/>
    <operation
        name="addArtifactToProject"
        operationType="update"
        model="//@models.2"
        isMethodController="true">
      <Saga
          name="AddArtifactToProject">
        <Steps
            name="validateUserCMD"
            commands="//@services.0/@api/@commands.0"/>
        <Steps
            name="validateArtifactCMD"
            commands="//@services.3/@api/@commands.0"/>
        <Steps
            name="addArtifactToProjectCMD"
            commands="//@services.2/@api/@commands.5"/>
        <Data
            name="AddArtifactToProject"/>
      </Saga>
    </operation>
    <operation
        name="completeAddArtifactToProject"
        operationType="update"
        publish="//@services.2/@api/@events.7"
        model="//@models.2"/>
    <operation
        name="removeArtifactFromProject"
        operationType="update"
        publish="//@services.2/@api/@events.9"
        model="//@models.2"
        isMethodController="true"/>
    <operation
        name="shareProjectToUser"
        operationType="update"
        publish="//@services.2/@api/@events.8"
        model="//@models.2"
        isMethodController="true"/>
    <operation
        name="addUserInProject"
        operationType="update"
        model="//@models.2"
        isMethodController="true">
      <Saga
          name="AddUserInProject">
        <Steps
            name="validateUserCMD"
            commands="//@services.0/@api/@commands.0"/>
        <Steps
            name="validateUserCMD"
            commands="//@services.0/@api/@commands.1"/>
        <Steps
            name="completeAddUserInProjectCMD"
            commands="//@services.2/@api/@commands.6"/>
        <Data
            name="AddUserInProject"/>
      </Saga>
    </operation>
    <operation
        name="completeAddUserInProject"
        operationType="update"
        publish="//@services.2/@api/@events.10"
        model="//@models.2"/>
    <operation
        name="removeUserFromProject"
        operationType="update"
        publish="//@services.2/@api/@events.11"
        model="//@models.2"
        isMethodController="true"/>
    <api name="api">
      <events
          name="ProjectCreatedEvent"/>
      <events
          name="ProjectUpdatedEvent"/>
      <events
          name="ProjectDeletedEvent"/>
      <events
          name="AddedProjectsToWorkspaceEvent"/>
      <events
          name="RejectedAddProjectToWorkspaceEvent"/>
      <events
          name="EditedProjectsToWorkspaceCommand"/>
      <events
          name="RejectedEditProjectsToWorkspaceCommand"/>
      <events
          name="AddedArtifactToProjectEvent"/>
      <events
          name="SharedProjectWithUserEvent"/>
      <events
          name="RemovedArtifactFromProjectEvent"/>
      <events
          name="AddedUserInProjectEvent"/>
      <events
          name="RemovedUserFromProjectEvent"/>
      <commands
          name="AddProjectsToWorkspaceCommand"
          commandType="reply"
          replyInfo="//@services.2/@api/@infos.0"
          isReplyInfoMany="true"/>
      <commands
          name="RejectAddProjectsToWorkspaceCommand"/>
      <commands
          name="EditProjectsToWorkspaceCommand"
          commandType="reply"
          replyInfo="//@services.2/@api/@infos.0"
          isReplyInfoMany="true"/>
      <commands
          name="RejectEditProjectsToWorkspaceCommand"/>
      <commands
          name="ValidateProjectCommand"
          commandType="invoke"/>
      <commands
          name="AddArtifactToProjectCommand"
          commandType="invoke"/>
      <commands
          name="CompleteAddUserInProjectCommand"
          commandType="invoke"/>
      <infos
          name="Project"
          dto="//@models.2"/>
    </api>
  </services>
  <services
      xsi:type="micro:AggregateService"
      name="artifact-service"
      fullname="ArtifactService"
      description="Artifact Service - MDEForge platform. "
      shortname="Artifact"
      port="5003"
      handleModelEvents="//@services.2/@modelEvents.0 //@services.0/@modelEvents.0"
      models="//@models.3 //@models.5 //@models.6 //@models.7 //@models.8 //@models.9">
    <modelEvents
        name="artifactModelEvent"
        model="//@models.3"/>
    <operation
        name="createArtifact"
        publish="//@services.3/@api/@events.0"
        model="//@models.3"
        isMethodController="true"/>
    <operation
        name="updateArtifact"
        operationType="update"
        publish="//@services.3/@api/@events.1"
        model="//@models.3"
        isMethodController="true"/>
    <operation
        name="findArtifact"
        operationType="retrieve"
        model="//@models.3"
        isMethodController="true"/>
    <operation
        name="deleteArtifact"
        operationType="delete"
        publish="//@services.3/@api/@events.2"
        model="//@models.3"
        isMethodController="true"/>
    <operation
        name="shareArtifactToUser"
        operationType="update"
        publish="//@services.3/@api/@events.3"
        model="//@models.3"
        isMethodController="true"/>
    <operation
        name="changeArtifactOpen"
        operationType="update"
        publish="//@services.3/@api/@events.4"
        model="//@models.3"
        isMethodController="true"/>
    <operation
        name="addArtifactToProjectList"
        operationType="update"
        publish="//@services.3/@api/@events.5"
        model="//@models.3"/>
    <operation
        name="removeArtifactToProjectList"
        operationType="update"
        publish="//@services.3/@api/@events.6"
        model="//@models.3"/>
    <api name="api">
      <events
          name="ArtifactCreatedEvent"/>
      <events
          name="ArtifactUpdatedEvent"/>
      <events
          name="ArtifactDeletedEvent"/>
      <events
          name="SharedArtifactToUserEvent"/>
      <events
          name="ChangedArtifactOpenEvent"/>
      <events
          name="AddedArtifactToProjectListEvent"/>
      <events
          name="RemovedArtifactToProjectListEvent"/>
      <commands
          name="ValidateArtifactCommand"
          commandType="invoke"/>
      <infos
          name="Artifact"
          dto="//@models.3"/>
      <infos
          name="Comment"
          dto="//@models.5"/>
      <infos
          name="Metric"
          dto="//@models.6"/>
      <infos
          name="Relation"
          dto="//@models.7"/>
      <infos
          name="Property"
          dto="//@models.8"/>
      <infos
          name="GridFileMedia"
          dto="//@models.9"/>
    </api>
  </services>
  <services
      xsi:type="micro:ViewService"
      name="mdeforgeview-service"
      fullname="MdeforgeviewService"
      description="MDEForgeView Service - MDEForge platform. "
      shortname="Mdeforgeview"
      port="5004"
      replicateServices="//@services.1 //@services.0 //@services.2 //@services.3"/>
  <models name="Workspace">
    <attributes
        xsi:type="micro:PrimitiveTypeAttribute"
        name="id"
        isId="true"
        isGenerated="true"/>
    <attributes
        xsi:type="micro:PrimitiveTypeAttribute"
        name="name"/>
    <attributes
        xsi:type="micro:PrimitiveTypeAttribute"
        name="description"/>
    <attributes
        xsi:type="micro:PrimitiveTypeAttribute"
        name="owner"
        ModelToView="//@models.1"/>
    <attributes
        xsi:type="micro:PrimitiveTypeAttribute"
        name="projects"
        isMany="true"
        ModelToView="//@models.2"/>
  </models>
  <models name="User">
    <attributes
        xsi:type="micro:PrimitiveTypeAttribute"
        name="id"
        isId="true"
        isGenerated="true"/>
    <attributes
        xsi:type="micro:PrimitiveTypeAttribute"
        name="firstname"/>
    <attributes
        xsi:type="micro:PrimitiveTypeAttribute"
        name="lastname"/>
    <attributes
        xsi:type="micro:PrimitiveTypeAttribute"
        name="email"/>
    <attributes
        xsi:type="micro:PrimitiveTypeAttribute"
        name="username"/>
    <attributes
        xsi:type="micro:PrimitiveTypeAttribute"
        name="image"/>
    <attributes
        xsi:type="micro:PrimitiveTypeAttribute"
        name="password"/>
    <attributes
        xsi:type="micro:PrimitiveTypeAttribute"
        name="enabled"
        type="boolean"/>
    <attributes
        xsi:type="micro:ReferenceAttribute"
        name="roles"
        isMany="true"
        type="//@models.4"/>
    <attributes
        xsi:type="micro:PrimitiveTypeAttribute"
        name="ownerArtifactList"
        isMany="true"
        ModelToView="//@models.3"/>
    <attributes
        xsi:type="micro:PrimitiveTypeAttribute"
        name="sharedArtifactList"
        isMany="true"
        ModelToView="//@models.3"/>
    <attributes
        xsi:type="micro:PrimitiveTypeAttribute"
        name="workspaceList"
        ModelToView="//@models.0"/>
  </models>
  <models name="Project">
    <attributes
        xsi:type="micro:PrimitiveTypeAttribute"
        name="id"
        isId="true"
        isGenerated="true"/>
    <attributes
        xsi:type="micro:PrimitiveTypeAttribute"
        name="name"/>
    <attributes
        xsi:type="micro:PrimitiveTypeAttribute"
        name="description"/>
    <attributes
        xsi:type="micro:PrimitiveTypeAttribute"
        name="open"
        type="boolean"/>
    <attributes
        xsi:type="micro:PrimitiveTypeAttribute"
        name="createdDate"/>
    <attributes
        xsi:type="micro:PrimitiveTypeAttribute"
        name="modifiedDate"/>
    <attributes
        xsi:type="micro:PrimitiveTypeAttribute"
        name="workspaceList"
        isMany="true"
        ModelToView="//@models.0"/>
    <attributes
        xsi:type="micro:PrimitiveTypeAttribute"
        name="artifactList"
        isMany="true"
        ModelToView="//@models.3"/>
    <attributes
        xsi:type="micro:PrimitiveTypeAttribute"
        name="userList"
        isMany="true"
        ModelToView="//@models.1"/>
    <attributes
        xsi:type="micro:PrimitiveTypeAttribute"
        name="owner"
        ModelToView="//@models.1"/>
  </models>
  <models name="Artifact">
    <attributes
        xsi:type="micro:PrimitiveTypeAttribute"
        name="id"
        isId="true"
        isGenerated="true"/>
    <attributes
        xsi:type="micro:PrimitiveTypeAttribute"
        name="name"/>
    <attributes
        xsi:type="micro:PrimitiveTypeAttribute"
        name="description"/>
    <attributes
        xsi:type="micro:PrimitiveTypeAttribute"
        name="open"
        type="boolean"/>
    <attributes
        xsi:type="micro:PrimitiveTypeAttribute"
        name="generated"
        type="boolean"/>
    <attributes
        xsi:type="micro:PrimitiveTypeAttribute"
        name="created"/>
    <attributes
        xsi:type="micro:PrimitiveTypeAttribute"
        name="modified"/>
    <attributes
        xsi:type="micro:PrimitiveTypeAttribute"
        name="authors"/>
    <attributes
        xsi:type="micro:PrimitiveTypeAttribute"
        name="version"/>
    <attributes
        xsi:type="micro:PrimitiveTypeAttribute"
        name="nameForIndex"/>
    <attributes
        xsi:type="micro:PrimitiveTypeAttribute"
        name="descriptionForIndex"/>
    <attributes
        xsi:type="micro:PrimitiveTypeAttribute"
        name="weightedContentsThree"/>
    <attributes
        xsi:type="micro:PrimitiveTypeAttribute"
        name="weightedContentsTwo"/>
    <attributes
        xsi:type="micro:PrimitiveTypeAttribute"
        name="weightedContentsOne"/>
    <attributes
        xsi:type="micro:PrimitiveTypeAttribute"
        name="defaultWeightedContents"/>
    <attributes
        xsi:type="micro:PrimitiveTypeAttribute"
        name="tags"
        isMany="true"/>
    <attributes
        xsi:type="micro:PrimitiveTypeAttribute"
        name="author"
        ModelToView="//@models.1"/>
    <attributes
        xsi:type="micro:PrimitiveTypeAttribute"
        name="projectList"
        isMany="true"
        ModelToView="//@models.2"/>
    <attributes
        xsi:type="micro:PrimitiveTypeAttribute"
        name="sharedUserList"
        isMany="true"
        ModelToView="//@models.1"/>
    <attributes
        xsi:type="micro:ReferenceAttribute"
        name="file"
        type="//@models.9"/>
    <attributes
        xsi:type="micro:ReferenceAttribute"
        name="comments"
        isMany="true"
        type="//@models.5"/>
    <attributes
        xsi:type="micro:ReferenceAttribute"
        name="metrics"
        isMany="true"
        type="//@models.6"/>
    <attributes
        xsi:type="micro:ReferenceAttribute"
        name="relations"
        isMany="true"
        type="//@models.7"/>
    <attributes
        xsi:type="micro:ReferenceAttribute"
        name="properties"
        isMany="true"
        type="//@models.8"/>
  </models>
  <models name="Role">
    <attributes
        xsi:type="micro:PrimitiveTypeAttribute"
        name="id"
        isId="true"/>
    <attributes
        xsi:type="micro:PrimitiveTypeAttribute"
        name="name"/>
  </models>
  <models name="Comment">
    <attributes
        xsi:type="micro:PrimitiveTypeAttribute"
        name="id"
        isId="true"
        isGenerated="true"/>
    <attributes
        xsi:type="micro:PrimitiveTypeAttribute"
        name="comment"/>
    <attributes
        xsi:type="micro:PrimitiveTypeAttribute"
        name="star"
        type="int"/>
    <attributes
        xsi:type="micro:PrimitiveTypeAttribute"
        name="user"
        ModelToView="//@models.1"/>
  </models>
  <models name="Metric">
    <attributes
        xsi:type="micro:PrimitiveTypeAttribute"
        name="id"
        isId="true"/>
    <attributes
        xsi:type="micro:PrimitiveTypeAttribute"
        name="name"/>
    <attributes
        xsi:type="micro:PrimitiveTypeAttribute"
        name="code"/>
    <attributes
        xsi:type="micro:PrimitiveTypeAttribute"
        name="artifact"
        ModelToView="//@models.3"/>
  </models>
  <models name="Relation">
    <attributes
        xsi:type="micro:PrimitiveTypeAttribute"
        name="id"
        isId="true"
        isGenerated="true"/>
    <attributes
        xsi:type="micro:PrimitiveTypeAttribute"
        name="name"/>
    <attributes
        xsi:type="micro:ReferenceAttribute"
        name="fromArtifact"
        type="//@models.3"/>
    <attributes
        xsi:type="micro:ReferenceAttribute"
        name="toArtifact"
        type="//@models.3"/>
  </models>
  <models name="Property">
    <attributes
        xsi:type="micro:PrimitiveTypeAttribute"
        name="id"
        isId="true"/>
    <attributes
        xsi:type="micro:PrimitiveTypeAttribute"
        name="name"/>
    <attributes
        xsi:type="micro:PrimitiveTypeAttribute"
        name="value"/>
  </models>
  <models name="GridFileMedia">
    <attributes
        xsi:type="micro:PrimitiveTypeAttribute"
        name="id"
        isId="true"/>
    <attributes
        xsi:type="micro:PrimitiveTypeAttribute"
        name="idFile"/>
    <attributes
        xsi:type="micro:PrimitiveTypeAttribute"
        name="fileName"/>
    <attributes
        xsi:type="micro:PrimitiveTypeAttribute"
        name="content"/>
  </models>
</micro:MicroserviceArchitecture>
